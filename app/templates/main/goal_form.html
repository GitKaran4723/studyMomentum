{% extends "base.html" %}

{% block title %}{{ title or 'Goal' }} - Study Momentum{% endblock %}
{% block page_title %}{{ title or 'Goal Configuration' }}{% endblock %}

{% block content %}
<div class="grid lg:grid-cols-2 gap-6 lg:gap-8 p-4 md:p-6 lg:p-8 max-w-7xl mx-auto">
    <!-- Hero Section -->
    <section class="bg-gradient-to-br from-green-500 via-emerald-500 to-teal-500 text-white rounded-3xl p-6 md:p-8 lg:p-10 shadow-2xl shadow-green-500/30">
        <span class="inline-flex items-center gap-2 px-4 py-2 bg-white/20 backdrop-blur-sm rounded-full font-semibold text-xs md:text-sm tracking-wider uppercase mb-4">
            <i class="material-icons text-lg">flag</i>
            Goal Architect
        </span>
        
        <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold leading-tight mb-4">
            Design your success blueprint.
        </h1>
        
        <p class="text-base md:text-lg opacity-95 mb-6 leading-relaxed">
            Create meaningful, measurable goals that inspire action and drive achievement. Transform aspirations into structured pathways toward success.
        </p>
        
        <ul class="space-y-3">
            <li class="flex items-center gap-3 bg-white/20 backdrop-blur-sm p-3 md:p-4 rounded-2xl">
                <i class="material-icons text-xl md:text-2xl">target</i>
                <span class="text-sm md:text-base font-medium">Define clear, specific objectives with measurable outcomes.</span>
            </li>
            <li class="flex items-center gap-3 bg-white/20 backdrop-blur-sm p-3 md:p-4 rounded-2xl">
                <i class="material-icons text-xl md:text-2xl">schedule</i>
                <span class="text-sm md:text-base font-medium">Set realistic timelines that create urgency without pressure.</span>
            </li>
            <li class="flex items-center gap-3 bg-white/20 backdrop-blur-sm p-3 md:p-4 rounded-2xl">
                <i class="material-icons text-xl md:text-2xl">trending_up</i>
                <span class="text-sm md:text-base font-medium">Track progress with meaningful metrics and milestones.</span>
            </li>
        </ul>
    </section>

    <!-- Form Card -->
    <div class="bg-white rounded-3xl shadow-2xl shadow-slate-200 overflow-hidden">
        <!-- Card Header -->
        <div class="bg-gradient-to-r from-blue-500 via-purple-500 to-indigo-600 text-white p-6 md:p-8">
            <h2 class="text-2xl md:text-3xl font-bold mb-2">
                {{ title or 'Configure Goal' }}
            </h2>
            <p class="text-sm md:text-base opacity-90">
                Build an achievement roadmap that motivates daily action and sustained progress.
            </p>
        </div>

        <!-- Form Body -->
        <form method="POST" class="p-6 md:p-8 lg:p-10 space-y-6">
            {{ form.hidden_tag() }}

            <!-- Goal Name -->
            <div class="space-y-2">
                <label for="goal_name" class="block text-sm font-semibold text-gray-900">
                    Goal Name <span class="text-red-500">*</span>
                </label>
                {{ form.goal_name(
                    class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:ring-4 focus:ring-green-500/20 outline-none transition-all duration-200 text-gray-900 placeholder-gray-400",
                    id="goal_name",
                    placeholder="e.g., Master Data Science, Run Marathon, Launch Startup"
                ) }}
                {% if form.goal_name.errors %}
                    <p class="text-sm text-red-600 flex items-center gap-1">
                        <i class="material-icons text-base">error</i>
                        {{ form.goal_name.errors[0] }}
                    </p>
                {% else %}
                    <p class="text-xs text-gray-500">
                        Specific, inspiring objective that motivates consistent action.
                    </p>
                {% endif %}
            </div>

            <!-- Description -->
            <div class="space-y-2">
                <label for="description" class="block text-sm font-semibold text-gray-900">
                    Goal Description
                </label>
                {{ form.description(
                    class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:ring-4 focus:ring-green-500/20 outline-none transition-all duration-200 text-gray-900 placeholder-gray-400 resize-y min-h-[120px]",
                    id="description",
                    rows="3",
                    placeholder="Describe what success looks like, why this goal matters, and how you'll measure achievement..."
                ) }}
                {% if form.description.errors %}
                    <p class="text-sm text-red-600 flex items-center gap-1">
                        <i class="material-icons text-base">error</i>
                        {{ form.description.errors[0] }}
                    </p>
                {% else %}
                    <p class="text-xs text-gray-500">
                        Clear vision of what you want to achieve and why it's important.
                    </p>
                {% endif %}
            </div>

            <!-- Category & Target Date -->
            <div class="grid md:grid-cols-2 gap-4 md:gap-6">
                <!-- Goal Category -->
                <div class="space-y-2">
                    <label for="goal_type" class="block text-sm font-semibold text-gray-900">
                        Goal Category <span class="text-red-500">*</span>
                    </label>
                    {{ form.goal_type(
                        class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:ring-4 focus:ring-green-500/20 outline-none transition-all duration-200 text-gray-900 bg-white appearance-none cursor-pointer",
                        id="goal_type",
                        style="background-image: url('data:image/svg+xml,%3Csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"%236b7280\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"%3E%3Cpolyline points=\"6 9 12 15 18 9\"/%3E%3C/svg%3E'); background-repeat: no-repeat; background-position: right 12px center; padding-right: 40px;"
                    ) }}
                    {% if form.goal_type.errors %}
                        <p class="text-sm text-red-600 flex items-center gap-1">
                            <i class="material-icons text-base">error</i>
                            {{ form.goal_type.errors[0] }}
                        </p>
                    {% else %}
                        <p class="text-xs text-gray-500">
                            Choose the primary focus area for this goal.
                        </p>
                    {% endif %}
                </div>

                <!-- Target Date -->
                <div class="space-y-2">
                    <label for="target_date" class="block text-sm font-semibold text-gray-900">
                        Target Completion
                    </label>
                    {{ form.target_date(
                        class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:ring-4 focus:ring-green-500/20 outline-none transition-all duration-200 text-gray-900 cursor-pointer",
                        id="target_date"
                    ) }}
                    {% if form.target_date.errors %}
                        <p class="text-sm text-red-600 flex items-center gap-1">
                            <i class="material-icons text-base">error</i>
                            {{ form.target_date.errors[0] }}
                        </p>
                    {% else %}
                        <p class="text-xs text-gray-500">
                            Realistic deadline that creates healthy urgency.
                        </p>
                    {% endif %}
                </div>
            </div>

            <!-- Target Value & Unit -->
            <div class="grid md:grid-cols-2 gap-4 md:gap-6">
                <!-- Target Metric -->
                <div class="space-y-2">
                    <label for="target_value" class="block text-sm font-semibold text-gray-900">
                        Target Metric
                    </label>
                    {{ form.target_value(
                        class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:ring-4 focus:ring-green-500/20 outline-none transition-all duration-200 text-gray-900 placeholder-gray-400",
                        id="target_value",
                        placeholder="100",
                        type="number"
                    ) }}
                    {% if form.target_value.errors %}
                        <p class="text-sm text-red-600 flex items-center gap-1">
                            <i class="material-icons text-base">error</i>
                            {{ form.target_value.errors[0] }}
                        </p>
                    {% else %}
                        <p class="text-xs text-gray-500">
                            Optional: Numerical target for measurable goals.
                        </p>
                    {% endif %}
                </div>

                <!-- Measurement Unit -->
                <div class="space-y-2">
                    <label for="unit" class="block text-sm font-semibold text-gray-900">
                        Measurement Unit
                    </label>
                    {{ form.unit(
                        class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:ring-4 focus:ring-green-500/20 outline-none transition-all duration-200 text-gray-900 placeholder-gray-400",
                        id="unit",
                        placeholder="e.g., pages, hours, miles, projects"
                    ) }}
                    {% if form.unit.errors %}
                        <p class="text-sm text-red-600 flex items-center gap-1">
                            <i class="material-icons text-base">error</i>
                            {{ form.unit.errors[0] }}
                        </p>
                    {% else %}
                        <p class="text-xs text-gray-500">
                            Optional: Unit of measurement for your target.
                        </p>
                    {% endif %}
                </div>
            </div>

            <!-- Success Criteria -->
            <div class="space-y-2">
                <label for="success_criteria" class="block text-sm font-semibold text-gray-900">
                    Success Criteria
                </label>
                {{ form.success_criteria(
                    class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:ring-4 focus:ring-green-500/20 outline-none transition-all duration-200 text-gray-900 placeholder-gray-400 resize-y min-h-[120px]",
                    id="success_criteria",
                    rows="3",
                    placeholder="Define specific conditions that indicate goal completion: skills gained, benchmarks achieved, outcomes delivered..."
                ) }}
                {% if form.success_criteria.errors %}
                    <p class="text-sm text-red-600 flex items-center gap-1">
                        <i class="material-icons text-base">error</i>
                        {{ form.success_criteria.errors[0] }}
                    </p>
                {% else %}
                    <p class="text-xs text-gray-500">
                        Optional: Clear definition of what "done" looks like.
                    </p>
                {% endif %}
            </div>

            <!-- Achievement Reward -->
            <div class="space-y-2">
                <label for="reward" class="block text-sm font-semibold text-gray-900">
                    Achievement Reward
                </label>
                {{ form.reward(
                    class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:ring-4 focus:ring-green-500/20 outline-none transition-all duration-200 text-gray-900 placeholder-gray-400",
                    id="reward",
                    placeholder="e.g., weekend trip, new equipment, celebration dinner"
                ) }}
                {% if form.reward.errors %}
                    <p class="text-sm text-red-600 flex items-center gap-1">
                        <i class="material-icons text-base">error</i>
                        {{ form.reward.errors[0] }}
                    </p>
                {% else %}
                    <p class="text-xs text-gray-500">
                        Optional: Meaningful reward to celebrate goal completion.
                    </p>
                {% endif %}
            </div>

            <!-- ==================== PREDICTION SETTINGS (Stage 3) ==================== -->
            {% if prediction_enabled %}
            <div class="space-y-4 pt-6 border-t-2 border-purple-200">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                        <i class="material-icons text-purple-600">psychology</i>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-gray-900">AI Prediction Settings</h3>
                        <p class="text-xs text-gray-500">Configure parameters for intelligent study planning</p>
                    </div>
                </div>

                <!-- Exam Date & Threshold -->
                <div class="grid md:grid-cols-2 gap-4">
                    <!-- Exam Date -->
                    <div class="space-y-2">
                        <label for="exam_date" class="block text-sm font-semibold text-gray-900">
                            <i class="material-icons text-sm align-middle text-red-600">event</i>
                            Exam Date
                        </label>
                        {{ form.exam_date(
                            class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:ring-4 focus:ring-purple-500/20 outline-none transition-all duration-200 text-gray-900 cursor-pointer",
                            id="exam_date"
                        ) }}
                        {% if form.exam_date.errors %}
                            <p class="text-sm text-red-600 flex items-center gap-1">
                                <i class="material-icons text-base">error</i>
                                {{ form.exam_date.errors[0] }}
                            </p>
                        {% else %}
                            <p class="text-xs text-gray-500">
                                Set exam date for probability calculations
                            </p>
                        {% endif %}
                    </div>

                    <!-- Passing Threshold -->
                    <div class="space-y-2">
                        <label for="threshold_marks" class="block text-sm font-semibold text-gray-900">
                            <i class="material-icons text-sm align-middle text-green-600">check_circle</i>
                            Passing Threshold (Marks)
                        </label>
                        {{ form.threshold_marks(
                            class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:ring-4 focus:ring-purple-500/20 outline-none transition-all duration-200 text-gray-900 placeholder-gray-400",
                            id="threshold_marks",
                            placeholder="e.g., 120 for UPSC Prelims",
                            type="number",
                            step="0.1"
                        ) }}
                        {% if form.threshold_marks.errors %}
                            <p class="text-sm text-red-600 flex items-center gap-1">
                                <i class="material-icons text-base">error</i>
                                {{ form.threshold_marks.errors[0] }}
                            </p>
                        {% else %}
                            <p class="text-xs text-gray-500">
                                Minimum marks required to pass
                            </p>
                        {% endif %}
                    </div>
                </div>

                <!-- Study Parameters -->
                <div class="grid md:grid-cols-2 gap-4">
                    <!-- Daily Hours Default -->
                    <div class="space-y-2">
                        <label for="daily_hours_default" class="block text-sm font-semibold text-gray-900">
                            <i class="material-icons text-sm align-middle text-blue-600">schedule</i>
                            Default Daily Study Hours
                        </label>
                        {{ form.daily_hours_default(
                            class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:ring-4 focus:ring-purple-500/20 outline-none transition-all duration-200 text-gray-900",
                            id="daily_hours_default",
                            type="number",
                            step="0.5",
                            min="0.5",
                            max="24"
                        ) }}
                        {% if form.daily_hours_default.errors %}
                            <p class="text-sm text-red-600 flex items-center gap-1">
                                <i class="material-icons text-base">error</i>
                                {{ form.daily_hours_default.errors[0] }}
                            </p>
                        {% else %}
                            <p class="text-xs text-gray-500">
                                Average daily study hours (default: 6.0)
                            </p>
                        {% endif %}
                    </div>

                    <!-- Split New Default -->
                    <div class="space-y-2">
                        <label for="split_new_default" class="block text-sm font-semibold text-gray-900">
                            <i class="material-icons text-sm align-middle text-orange-600">pie_chart</i>
                            New Learning Split (0-1)
                        </label>
                        {{ form.split_new_default(
                            class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:ring-4 focus:ring-purple-500/20 outline-none transition-all duration-200 text-gray-900",
                            id="split_new_default",
                            type="number",
                            step="0.05",
                            min="0",
                            max="1"
                        ) }}
                        {% if form.split_new_default.errors %}
                            <p class="text-sm text-red-600 flex items-center gap-1">
                                <i class="material-icons text-base">error</i>
                                {{ form.split_new_default.errors[0] }}
                            </p>
                        {% else %}
                            <p class="text-xs text-gray-500">
                                Fraction for new learning (0.6 = 60% new, 40% revision)
                            </p>
                        {% endif %}
                    </div>
                </div>

                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                    <div class="flex items-start gap-3">
                        <i class="material-icons text-purple-600">info</i>
                        <div class="text-sm text-gray-700">
                            <p class="font-semibold mb-1">About AI Predictions</p>
                            <p class="text-xs">These settings help the AI system predict your exam readiness and optimize your daily study plan. Set your exam date and passing threshold for probability calculations.</p>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            <!-- ================================================================== -->

            <!-- Form Actions -->
            <div class="flex flex-col-reverse sm:flex-row gap-3 pt-4 border-t border-gray-100">
                <a href="{{ url_for('main.goals') }}" 
                   class="flex-1 sm:flex-none px-6 py-3 text-center bg-gray-100 text-gray-700 font-semibold rounded-xl hover:bg-gray-200 transition-colors duration-200">
                    Cancel
                </a>
                {{ form.submit(
                    class="flex-1 sm:flex-none px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-semibold rounded-xl hover:from-green-600 hover:to-emerald-700 shadow-lg shadow-green-500/30 hover:shadow-xl hover:shadow-green-500/40 transition-all duration-200 cursor-pointer"
                ) }}
            </div>
        </form>
    </div>
</div>
{% endblock %}