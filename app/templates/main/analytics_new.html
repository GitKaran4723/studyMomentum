{% extends "base.html" %}

{% block title %}Analytics - Study Momentum{% endblock %}

{% block content %}
<!-- Analytics Hero Section -->
<div class="bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 text-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="text-center">
            <!-- Badge -->
            <div class="inline-flex items-center px-4 py-2 bg-white/20 backdrop-blur-sm rounded-full text-sm font-medium mb-6">
                <i class="material-icons text-lg mr-2">analytics</i>
                <span>Analytics Dashboard</span>
            </div>
            
            <!-- Title -->
            <h1 class="text-4xl lg:text-5xl font-bold mb-4">
                Insights that drive
                <span class="bg-gradient-to-r from-yellow-300 to-orange-300 bg-clip-text text-transparent">growth.</span>
            </h1>
            <p class="text-lg lg:text-xl text-blue-100 mb-8 max-w-3xl mx-auto">
                Transform your data into actionable insights. Track patterns, identify opportunities, and optimize your path to success with comprehensive performance analytics.
            </p>
            
            <!-- Hero Stats -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-3xl mx-auto">
                <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20">
                    <div class="text-3xl font-bold mb-1">{{ analytics_data.get('total_sessions', 0) }}</div>
                    <div class="text-blue-200">Study Sessions</div>
                </div>
                <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20">
                    <div class="text-3xl font-bold mb-1">{{ analytics_data.get('total_hours', 0) }}</div>
                    <div class="text-blue-200">Hours Tracked</div>
                </div>
                <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20">
                    <div class="text-3xl font-bold mb-1">{{ analytics_data.get('productivity_score', 0) }}%</div>
                    <div class="text-blue-200">Productivity</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Analytics Content -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Time Period Selector -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8">
        <div class="flex flex-wrap gap-2 justify-center">
            <button class="px-4 py-2 bg-blue-600 text-white rounded-lg font-medium tab-btn active" data-period="week">
                This Week
            </button>
            <button class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition-colors tab-btn" data-period="month">
                This Month
            </button>
            <button class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition-colors tab-btn" data-period="quarter">
                3 Months
            </button>
            <button class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition-colors tab-btn" data-period="year">
                This Year
            </button>
        </div>
    </div>

    <!-- Key Metrics Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- Task Completion Rate -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center space-x-2">
                    <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                        <i class="material-icons text-green-600">assignment_turned_in</i>
                    </div>
                    <h3 class="font-semibold text-gray-900">Task Completion</h3>
                </div>
                <span class="text-xs text-green-600 bg-green-100 px-2 py-1 rounded-full">+5.2%</span>
            </div>
            <div class="text-3xl font-bold text-gray-900 mb-2">{{ analytics_data.get('completion_rate', 0) }}%</div>
            <div class="w-full bg-gray-200 rounded-full h-2">
                <div class="bg-green-600 h-2 rounded-full transition-all duration-500" style="width: {{ analytics_data.get('completion_rate', 0) }}%"></div>
            </div>
        </div>

        <!-- Focus Time -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center space-x-2">
                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                        <i class="material-icons text-blue-600">schedule</i>
                    </div>
                    <h3 class="font-semibold text-gray-900">Focus Time</h3>
                </div>
                <span class="text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded-full">+12.1%</span>
            </div>
            <div class="text-3xl font-bold text-gray-900 mb-2">{{ analytics_data.get('focus_hours', 0) }}h</div>
            <p class="text-sm text-gray-600">Daily average: {{ (analytics_data.get('focus_hours', 0) / 7)|round(1) }}h</p>
        </div>

        <!-- Streak Days -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center space-x-2">
                    <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
                        <i class="material-icons text-orange-600">local_fire_department</i>
                    </div>
                    <h3 class="font-semibold text-gray-900">Current Streak</h3>
                </div>
                <span class="text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded-full">Active</span>
            </div>
            <div class="text-3xl font-bold text-gray-900 mb-2">{{ analytics_data.get('current_streak', 0) }}</div>
            <p class="text-sm text-gray-600">days in a row</p>
        </div>

        <!-- Goal Progress -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center space-x-2">
                    <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                        <i class="material-icons text-purple-600">flag</i>
                    </div>
                    <h3 class="font-semibold text-gray-900">Goals Achieved</h3>
                </div>
                <span class="text-xs text-purple-600 bg-purple-100 px-2 py-1 rounded-full">+3</span>
            </div>
            <div class="text-3xl font-bold text-gray-900 mb-2">{{ analytics_data.get('completed_goals', 0) }}/{{ analytics_data.get('total_goals', 0) }}</div>
            <div class="w-full bg-gray-200 rounded-full h-2">
                <div class="bg-purple-600 h-2 rounded-full transition-all duration-500" 
                     style="width: {{ (analytics_data.get('completed_goals', 0) / analytics_data.get('total_goals', 1) * 100)|round }}%"></div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
        <!-- Activity Chart -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Daily Activity</h3>
                <div class="flex items-center space-x-2 text-sm text-gray-600">
                    <div class="w-3 h-3 bg-blue-600 rounded-full"></div>
                    <span>Tasks Completed</span>
                </div>
            </div>
            <div class="h-64 flex items-end justify-between space-x-2">
                {% for day in ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'] %}
                <div class="flex flex-col items-center flex-1">
                    <div class="w-full bg-gray-200 rounded-t-lg relative" style="height: 200px;">
                        <div class="absolute bottom-0 w-full bg-blue-600 rounded-t-lg transition-all duration-500" 
                             style="height: {{ (loop.index * 20 + 30) }}px;"></div>
                    </div>
                    <span class="text-xs text-gray-600 mt-2">{{ day }}</span>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Progress Overview -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-6">Progress Overview</h3>
            <div class="space-y-6">
                <!-- Study Time Progress -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-gray-700">Study Time Goal</span>
                        <span class="text-sm font-bold text-blue-600">{{ analytics_data.get('weekly_hours', 0) }}/40h</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div class="bg-blue-600 h-3 rounded-full transition-all duration-500" 
                             style="width: {{ (analytics_data.get('weekly_hours', 0) / 40 * 100)|round }}%"></div>
                    </div>
                </div>

                <!-- Task Completion Progress -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-gray-700">Weekly Tasks</span>
                        <span class="text-sm font-bold text-green-600">{{ analytics_data.get('weekly_tasks', 0) }}/25</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div class="bg-green-600 h-3 rounded-full transition-all duration-500" 
                             style="width: {{ (analytics_data.get('weekly_tasks', 0) / 25 * 100)|round }}%"></div>
                    </div>
                </div>

                <!-- Goal Progress -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-gray-700">Goal Milestones</span>
                        <span class="text-sm font-bold text-purple-600">{{ analytics_data.get('monthly_milestones', 0) }}/10</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div class="bg-purple-600 h-3 rounded-full transition-all duration-500" 
                             style="width: {{ (analytics_data.get('monthly_milestones', 0) / 10 * 100)|round }}%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Subject Performance -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8">
        <h3 class="text-lg font-semibold text-gray-900 mb-6">Subject Performance</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% set subjects = [
                {'name': 'Mathematics', 'progress': 85, 'color': 'blue'},
                {'name': 'Physics', 'progress': 72, 'color': 'green'},
                {'name': 'Chemistry', 'progress': 68, 'color': 'purple'},
                {'name': 'Biology', 'progress': 91, 'color': 'orange'},
                {'name': 'Computer Science', 'progress': 79, 'color': 'indigo'},
                {'name': 'English', 'progress': 88, 'color': 'pink'}
            ] %}
            
            {% for subject in subjects %}
            <div class="bg-gray-50 rounded-lg p-4">
                <div class="flex items-center justify-between mb-3">
                    <h4 class="font-medium text-gray-900">{{ subject.name }}</h4>
                    <span class="text-sm font-bold text-{{ subject.color }}-600">{{ subject.progress }}%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-{{ subject.color }}-600 h-2 rounded-full transition-all duration-500" 
                         style="width: {{ subject.progress }}%"></div>
                </div>
                <div class="flex justify-between text-xs text-gray-500 mt-2">
                    <span>{{ (subject.progress * 0.15)|round }} tasks</span>
                    <span>{{ (subject.progress * 0.8)|round }}h studied</span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Recent Activity Feed -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-6">Recent Achievements</h3>
        <div class="space-y-4">
            {% set achievements = [
                {'icon': 'emoji_events', 'color': 'yellow', 'title': 'Goal Completed', 'desc': 'Finished "Complete Calculus Course"', 'time': '2 hours ago'},
                {'icon': 'local_fire_department', 'color': 'orange', 'title': '7-Day Streak', 'desc': 'Maintained daily study consistency', 'time': '1 day ago'},
                {'icon': 'assignment_turned_in', 'color': 'green', 'title': 'Task Marathon', 'desc': 'Completed 15 tasks in one day', 'time': '2 days ago'},
                {'icon': 'schedule', 'color': 'blue', 'title': 'Focus Champion', 'desc': 'Studied for 6 hours straight', 'time': '3 days ago'},
                {'icon': 'school', 'color': 'purple', 'title': 'Subject Mastery', 'desc': 'Achieved 90% in Physics', 'time': '1 week ago'}
            ] %}
            
            {% for achievement in achievements %}
            <div class="flex items-center space-x-4 p-3 bg-gray-50 rounded-lg">
                <div class="w-10 h-10 bg-{{ achievement.color }}-100 rounded-full flex items-center justify-center flex-shrink-0">
                    <i class="material-icons text-{{ achievement.color }}-600">{{ achievement.icon }}</i>
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-gray-900">{{ achievement.title }}</p>
                    <p class="text-sm text-gray-600">{{ achievement.desc }}</p>
                </div>
                <div class="text-xs text-gray-500">{{ achievement.time }}</div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Analytics JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const tabButtons = document.querySelectorAll('.tab-btn');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            tabButtons.forEach(btn => {
                btn.classList.remove('active', 'bg-blue-600', 'text-white');
                btn.classList.add('bg-gray-100', 'text-gray-700');
            });
            
            this.classList.add('active', 'bg-blue-600', 'text-white');
            this.classList.remove('bg-gray-100', 'text-gray-700');
            
            const period = this.dataset.period;
            updateAnalyticsData(period);
        });
    });
    
    setTimeout(() => {
        const progressBars = document.querySelectorAll('[style*="width:"]');
        progressBars.forEach(bar => {
            const width = bar.style.width;
            bar.style.width = '0%';
            bar.offsetHeight;
            bar.style.width = width;
        });
    }, 500);
});

function updateAnalyticsData(period) {
    const metricsGrid = document.querySelector('.grid.grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-4');
    if (metricsGrid) {
        metricsGrid.style.opacity = '0.7';
    }
    
    setTimeout(() => {
        console.log(`Updating analytics for period: ${period}`);
        
        if (metricsGrid) {
            metricsGrid.style.opacity = '1';
        }
        
        showNotification(`Analytics updated for ${period.replace('_', ' ')}`);
    }, 1000);
}

function showNotification(message) {
    const notification = document.createElement('div');
    notification.className = 'fixed top-4 right-4 z-50 px-6 py-3 bg-green-600 text-white rounded-lg shadow-lg transform transition-all duration-300 translate-x-full';
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.classList.remove('translate-x-full');
    }, 100);
    
    setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}
</script>
{% endblock %}